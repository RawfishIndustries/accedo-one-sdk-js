!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.accedoOne=t()}(this,function(){"use strict";function e(e,t){return e(t={exports:{}},t.exports),t.exports}for(var t=e(function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}}),r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);var o,i,s=function(e,t){var n=t||0,o=r;return o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]},a=0,c=0;var u=function(e,r,n){var u=r&&n||0,l=r||[],p=(e=e||{}).node||o,f=void 0!==e.clockseq?e.clockseq:i;if(null==p||null==f){var d=t();null==p&&(p=o=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==f&&(f=i=16383&(d[6]<<8|d[7]))}var v=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:c+1,h=v-a+(g-c)/1e4;if(h<0&&void 0===e.clockseq&&(f=f+1&16383),(h<0||v>a)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=v,c=g,i=f;var y=(1e4*(268435455&(v+=122192928e5))+g)%4294967296;l[u++]=y>>>24&255,l[u++]=y>>>16&255,l[u++]=y>>>8&255,l[u++]=255&y;var m=v/4294967296*1e4&268435455;l[u++]=m>>>8&255,l[u++]=255&m,l[u++]=m>>>24&15|16,l[u++]=m>>>16&255,l[u++]=f>>>8|128,l[u++]=255&f;for(var b=0;b<6;++b)l[u+b]=p[b];return r||s(l)};var l=function(e,r,n){var o=r&&n||0;"string"==typeof e&&(r="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||t)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,r)for(var a=0;a<16;++a)r[o+a]=i[a];return r||s(i)},p=l;p.v1=u,p.v4=l;var f=p,d=function(){},v=function(e){return function(t){var r=t.gid,n=t.appKey,o=t.ip,i=t.target,s=t.useSharedSession,a=t.sessionKeyInQueryString,c=t.log;void 0===c&&(c=d);var u=t.onDeviceIdGenerated;void 0===u&&(u=d);var l=t.onSessionKeyChanged;void 0===l&&(l=d);var p=t.deviceId,v=t.sessionKey;if(p||(v=null),!function(e){void 0===e&&(e={});var t=e.appKey,r=e.deviceId,n=e.sessionKey;return t&&!r&&!n||t&&r}({appKey:n,deviceId:p,sessionKey:v}))throw new Error("You must provide an appKey | an appKey and a deviceId | an appKey, a deviceId and a sessionKey");p||u(p=f.v4());var g={deviceId:p,gid:r,ip:o,appKey:n,target:i,log:c,useSharedSession:s,onSessionKeyChanged:l,sessionKeyInQueryString:a};return Object.defineProperty(g,"sessionKey",{set:function(e){e!==v&&(v=e,l(e))},get:function(){return v}}),e.props({config:g}).create()}},g=!1,h=!1;try{g="undefined"!=typeof localStorage,h="undefined"!=typeof sessionStorage}catch(e){}var y=g||h,m=function(){try{return{deviceId:localStorage.ag_d,sessionKey:h?sessionStorage.ag_s:void 0}}catch(e){return{}}},b=function(e){if(g)try{localStorage.ag_d=e}catch(e){}},S=function(e){if(h)try{sessionStorage.ag_s=e}catch(e){}},O=function(e){return function(t){var r=v(e);if(!y)return r(t);var n=t.browserInfoProvider;void 0===n&&(n=m);var o=t.onDeviceIdGenerated;void 0===o&&(o=b);var i=t.onSessionKeyChanged;void 0===i&&(i=S);var s=t.deviceId,a=t.sessionKey;if((!s||!a)&&n){var c=n();s=s||c.deviceId,a=a||c.sessionKey}return r(Object.assign({},t,{deviceId:s,sessionKey:a,onDeviceIdGenerated:o,onSessionKeyChanged:i}))}},w=Array.isArray,P=function(e){return"function"==typeof e},j=function(e){var t=typeof e;return Boolean(e)&&("object"===t||"function"===t)},A=function(e){return P(e)&&P(e.compose)},D=j,K=Object.assign,L=function(e){return Boolean(e)&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype};function x(e,t){if(void 0===t)return e;if(w(t))return(w(e)?e:[]).concat(t);if(!L(t))return t;for(var r=j(e)?e:{},n=Object.keys(t),o=0;o<n.length;o+=1){var i=n[o],s=t[i];if(void 0!==s){var a=r[i],c=L(a)||w(s)?a:{};r[i]=x(c,s)}}return r}var T=function(e){for(var t=arguments,r=1;r<arguments.length;r++)e=x(e,t[r]);return e},C=Array.prototype.slice;function I(e,t){var r=function e(t){var r=arguments,n=e.compose||{},o={__proto__:n.methods};if(T(o,n.deepProperties),K(o,n.properties),Object.defineProperties(o,n.propertyDescriptors||{}),!n.initializers||0===n.initializers.length)return o;void 0===t&&(t={});for(var i=n.initializers,s=i.length,a=0;a<s;a+=1){var c=i[a];if(P(c)){var u=c.call(o,t,{instance:o,stamp:e,args:C.apply(r)});o=void 0===u?o:u}}return o};e.staticDeepProperties&&T(r,e.staticDeepProperties),e.staticProperties&&K(r,e.staticProperties),e.staticPropertyDescriptors&&Object.defineProperties(r,e.staticPropertyDescriptors);var n=P(r.compose)?r.compose:t;return r.compose=function(){return n.apply(this,arguments)},K(r.compose,e),r}function E(e,t,r){if(w(t)){var n=t.length,o=e[r]||[];e[r]=o;for(var i=0;i<n;i+=1){var s=t[i];P(s)&&o.indexOf(s)<0&&o.push(s)}}}function R(e,t,r,n){j(t[r])&&(j(e[r])||(e[r]={}),n(e[r],t[r]))}function H(e,t,r){R(e,t,r,T)}function N(e,t,r){R(e,t,r,K)}function k(e,t){var r=t&&t.compose||t;N(e,r,"methods"),N(e,r,"properties"),H(e,r,"deepProperties"),N(e,r,"propertyDescriptors"),N(e,r,"staticProperties"),H(e,r,"staticDeepProperties"),N(e,r,"staticPropertyDescriptors"),N(e,r,"configuration"),H(e,r,"deepConfiguration"),E(e,r.initializers,"initializers"),E(e,r.composers,"composers")}var B=function e(){var t=arguments,r={},n=[];D(this)&&(k(r,this),n.push(this));for(var o=0;o<arguments.length;o++){var i=t[o];D(i)&&(k(r,i),n.push(i))}var s=I(r,e),a=r.composers;if(w(a)&&a.length>0)for(var c=0;c<a.length;c+=1){var u=(0,a[c])({stamp:s,composables:n});s=A(u)?u:s}return s};function z(e){return function(t){var r={};return r[e]=t,this&&this.compose?this.compose(r):B(r)}}var U=z("properties"),q=z("staticProperties"),F=z("configuration"),G=z("deepProperties"),Q=z("staticDeepProperties"),_=z("deepConfiguration"),V=z("initializers"),M=B({staticProperties:{methods:z("methods"),props:U,properties:U,statics:q,staticProperties:q,conf:F,configuration:F,deepProps:G,deepProperties:G,deepStatics:Q,staticDeepProperties:Q,deepConf:_,deepConfiguration:_,init:V,initializers:V,composers:z("composers"),propertyDescriptors:z("propertyDescriptors"),staticPropertyDescriptors:z("staticPropertyDescriptors")}}),J=Array.prototype.concat;function W(){var e=J.apply([],arguments).filter(P);return 0===e.length?void 0:e}function X(e){if(!j(e))return e;var t=e.methods,r=e.properties,n=e.props,o=e.initializers,i=e.init,s=e.composers,a=e.deepProperties,c=e.deepProps,u=e.propertyDescriptors,l=e.staticProperties,p=e.statics,f=e.staticDeepProperties,d=e.deepStatics,v=e.staticPropertyDescriptors,g=e.configuration,h=e.conf,y=e.deepConfiguration,m=e.deepConf,b=j(n)||j(r)?K({},n,r):void 0,S=j(c)?T({},c):void 0;S=j(a)?T(S,a):S;var O=j(p)||j(l)?K({},p,l):void 0,w=j(d)?T({},d):void 0;w=j(f)?T(w,f):w;var P=j(h)||j(g)?K({},h,g):void 0,A=j(m)?T({},m):void 0;A=j(y)?T(A,y):A;var D=W(i,o),L=W(s),x={};return t&&(x.methods=t),b&&(x.properties=b),D&&(x.initializers=D),L&&(x.composers=L),S&&(x.deepProperties=S),O&&(x.staticProperties=O),w&&(x.staticDeepProperties=w),u&&(x.propertyDescriptors=u),v&&(x.staticPropertyDescriptors=v),P&&(x.configuration=P),A&&(x.deepConfiguration=A),x}function $(){for(var e=arguments,t=arguments.length,r=[],n=0;n<t;n+=1){var o=e[n];r.push(A(o)?o:X(o))}return B.apply(this||Y,r)}var Y=M.compose({staticProperties:{create:function(){return this.apply(this,arguments)},compose:$}}),Z=M.compose.staticProperties;for(var ee in Z)$[ee]=Z[ee].bind(Y);$.compose=$.bind();var te=$,re="function"==typeof fetch?fetch.bind():function(e,t){return t=t||{},new Promise(function(r,n){var o=new XMLHttpRequest;for(var i in o.open(t.method||"get",e),t.headers)o.setRequestHeader(i,t.headers[i]);function s(){var e,t=[],r=[],n={};return o.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,function(o,i,s){t.push(i=i.toLowerCase()),r.push([i,s]),e=n[i],n[i]=e?e+","+s:s}),{ok:1==(o.status/200|0),status:o.status,statusText:o.statusText,url:o.responseURL,clone:s,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},headers:{keys:function(){return t},entries:function(){return r},get:function(e){return n[e.toLowerCase()]},has:function(e){return e.toLowerCase()in n}}}}o.withCredentials="include"==t.credentials,o.onload=function(){r(s())},o.onerror=n,o.send(t.body)})},ne=Object.freeze({default:re}),oe=ne&&re||ne,ie=window.fetch||(window.fetch=oe.default||oe),se=e(function(e,t){var r=Object.prototype.hasOwnProperty,n=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}();t.arrayToObject=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r},t.merge=function(e,n,o){if(!n)return e;if("object"!=typeof n){if(Array.isArray(e))e.push(n);else{if("object"!=typeof e)return[e,n];(o.plainObjects||o.allowPrototypes||!r.call(Object.prototype,n))&&(e[n]=!0)}return e}if("object"!=typeof e)return[e].concat(n);var i=e;return Array.isArray(e)&&!Array.isArray(n)&&(i=t.arrayToObject(e,o)),Array.isArray(e)&&Array.isArray(n)?(n.forEach(function(n,i){r.call(e,i)?e[i]&&"object"==typeof e[i]?e[i]=t.merge(e[i],n,o):e.push(n):e[i]=n}),e):Object.keys(n).reduce(function(e,i){var s=n[i];return r.call(e,i)?e[i]=t.merge(e[i],s,o):e[i]=s,e},i)},t.assign=function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},t.decode=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},t.encode=function(e){if(0===e.length)return e;for(var t="string"==typeof e?e:String(e),r="",o=0;o<t.length;++o){var i=t.charCodeAt(o);45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122?r+=t.charAt(o):i<128?r+=n[i]:i<2048?r+=n[192|i>>6]+n[128|63&i]:i<55296||i>=57344?r+=n[224|i>>12]+n[128|i>>6&63]+n[128|63&i]:(o+=1,i=65536+((1023&i)<<10|1023&t.charCodeAt(o)),r+=n[240|i>>18]+n[128|i>>12&63]+n[128|i>>6&63]+n[128|63&i])}return r},t.compact=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var o=t[n],i=o.obj[o.prop],s=Object.keys(i),a=0;a<s.length;++a){var c=s[a],u=i[c];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:i,prop:c}),r.push(u))}return function(e){for(var t;e.length;){var r=e.pop();if(t=r.obj[r.prop],Array.isArray(t)){for(var n=[],o=0;o<t.length;++o)void 0!==t[o]&&n.push(t[o]);r.obj[r.prop]=n}}return t}(t)},t.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},t.isBuffer=function(e){return null!==e&&void 0!==e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}}),ae=(se.arrayToObject,se.merge,se.assign,se.decode,se.encode,se.compact,se.isRegExp,se.isBuffer,String.prototype.replace),ce=/%20/g,ue={default:"RFC3986",formatters:{RFC1738:function(e){return ae.call(e,ce,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"},le={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},pe=Date.prototype.toISOString,fe={delimiter:"&",encode:!0,encoder:se.encode,encodeValuesOnly:!1,serializeDate:function(e){return pe.call(e)},skipNulls:!1,strictNullHandling:!1},de=function e(t,r,n,o,i,s,a,c,u,l,p,f){var d=t;if("function"==typeof a)d=a(r,d);else if(d instanceof Date)d=l(d);else if(null===d){if(o)return s&&!f?s(r,fe.encoder):r;d=""}if("string"==typeof d||"number"==typeof d||"boolean"==typeof d||se.isBuffer(d))return s?[p(f?r:s(r,fe.encoder))+"="+p(s(d,fe.encoder))]:[p(r)+"="+p(String(d))];var v,g=[];if(void 0===d)return g;if(Array.isArray(a))v=a;else{var h=Object.keys(d);v=c?h.sort(c):h}for(var y=0;y<v.length;++y){var m=v[y];i&&null===d[m]||(g=Array.isArray(d)?g.concat(e(d[m],n(r,m),n,o,i,s,a,c,u,l,p,f)):g.concat(e(d[m],r+(u?"."+m:"["+m+"]"),n,o,i,s,a,c,u,l,p,f)))}return g},ve=Object.prototype.hasOwnProperty,ge={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:se.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},he=function(e,t,r){if(e){var n=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,i=/(\[[^[\]]*])/.exec(n),s=i?n.slice(0,i.index):n,a=[];if(s){if(!r.plainObjects&&ve.call(Object.prototype,s)&&!r.allowPrototypes)return;a.push(s)}for(var c=0;null!==(i=o.exec(n))&&c<r.depth;){if(c+=1,!r.plainObjects&&ve.call(Object.prototype,i[1].slice(1,-1))&&!r.allowPrototypes)return;a.push(i[1])}return i&&a.push("["+n.slice(i.index)+"]"),function(e,t,r){for(var n=t,o=e.length-1;o>=0;--o){var i,s=e[o];if("[]"===s)i=(i=[]).concat(n);else{i=r.plainObjects?Object.create(null):{};var a="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,c=parseInt(a,10);!isNaN(c)&&s!==a&&String(c)===a&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(i=[])[c]=n:i[a]=n}n=i}return n}(a,t,r)}},ye=function(e,t){var r=t?se.assign({},t):{};if(null!==r.decoder&&void 0!==r.decoder&&"function"!=typeof r.decoder)throw new TypeError("Decoder has to be a function.");if(r.ignoreQueryPrefix=!0===r.ignoreQueryPrefix,r.delimiter="string"==typeof r.delimiter||se.isRegExp(r.delimiter)?r.delimiter:ge.delimiter,r.depth="number"==typeof r.depth?r.depth:ge.depth,r.arrayLimit="number"==typeof r.arrayLimit?r.arrayLimit:ge.arrayLimit,r.parseArrays=!1!==r.parseArrays,r.decoder="function"==typeof r.decoder?r.decoder:ge.decoder,r.allowDots="boolean"==typeof r.allowDots?r.allowDots:ge.allowDots,r.plainObjects="boolean"==typeof r.plainObjects?r.plainObjects:ge.plainObjects,r.allowPrototypes="boolean"==typeof r.allowPrototypes?r.allowPrototypes:ge.allowPrototypes,r.parameterLimit="number"==typeof r.parameterLimit?r.parameterLimit:ge.parameterLimit,r.strictNullHandling="boolean"==typeof r.strictNullHandling?r.strictNullHandling:ge.strictNullHandling,""===e||null===e||void 0===e)return r.plainObjects?Object.create(null):{};for(var n="string"==typeof e?function(e,t){for(var r={},n=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,o=t.parameterLimit===1/0?void 0:t.parameterLimit,i=n.split(t.delimiter,o),s=0;s<i.length;++s){var a,c,u=i[s],l=u.indexOf("]="),p=-1===l?u.indexOf("="):l+1;-1===p?(a=t.decoder(u,ge.decoder),c=t.strictNullHandling?null:""):(a=t.decoder(u.slice(0,p),ge.decoder),c=t.decoder(u.slice(p+1),ge.decoder)),ve.call(r,a)?r[a]=[].concat(r[a]).concat(c):r[a]=c}return r}(e,r):e,o=r.plainObjects?Object.create(null):{},i=Object.keys(n),s=0;s<i.length;++s){var a=i[s],c=he(a,n[a],r);o=se.merge(o,c,r)}return se.compact(o)},me=function(e,t){var r=e,n=t?se.assign({},t):{};if(null!==n.encoder&&void 0!==n.encoder&&"function"!=typeof n.encoder)throw new TypeError("Encoder has to be a function.");var o=void 0===n.delimiter?fe.delimiter:n.delimiter,i="boolean"==typeof n.strictNullHandling?n.strictNullHandling:fe.strictNullHandling,s="boolean"==typeof n.skipNulls?n.skipNulls:fe.skipNulls,a="boolean"==typeof n.encode?n.encode:fe.encode,c="function"==typeof n.encoder?n.encoder:fe.encoder,u="function"==typeof n.sort?n.sort:null,l=void 0!==n.allowDots&&n.allowDots,p="function"==typeof n.serializeDate?n.serializeDate:fe.serializeDate,f="boolean"==typeof n.encodeValuesOnly?n.encodeValuesOnly:fe.encodeValuesOnly;if(void 0===n.format)n.format=ue.default;else if(!Object.prototype.hasOwnProperty.call(ue.formatters,n.format))throw new TypeError("Unknown format option provided.");var d,v,g=ue.formatters[n.format];"function"==typeof n.filter?r=(v=n.filter)("",r):Array.isArray(n.filter)&&(d=v=n.filter);var h,y=[];if("object"!=typeof r||null===r)return"";h=n.arrayFormat in le?n.arrayFormat:"indices"in n?n.indices?"indices":"repeat":"indices";var m=le[h];d||(d=Object.keys(r)),u&&d.sort(u);for(var b=0;b<d.length;++b){var S=d[b];s&&null===r[S]||(y=y.concat(de(r[S],S,m,i,s,a?c:null,v,u,l,p,g,f)))}var O=y.join(o),w=!0===n.addQueryPrefix?"?":"";return O.length>0?w+O:""},be=function(e,t){void 0===t&&(t={});var r=t.id,n=t.gid,o=t.typeId,i=t.alias,s=t.typeAlias,a=t.preview,c=t.at,u=t.offset,l=t.size,p=t.locale,f={};return r&&Array.isArray(r)&&(f.id=r.join(",")),i&&Array.isArray(i)&&(f.alias=i.join(",")),"string"==typeof n&&(f.gid=n),o&&Array.isArray(o)&&(f.typeId=o.join(",")),a&&(f.preview=!0),"string"==typeof c?f.at=c:c&&c.toISOString&&(f.at=c.toISOString()),e+"?"+me(Object.assign({},f,{typeAlias:s,offset:u,size:l,locale:p}))},Se=function(e,t){var r=t.target;void 0===r&&(r="https://api.one.accedo.tv");var n=e.split("?");return""+r+n[0]+"?"+function(e,t){void 0===t&&(t={});var r=e.sessionKey?{}:{appKey:e.appKey,uuid:e.deviceId};e.gid&&(r.gid=e.gid),e.sessionKey&&e.sessionKeyInQueryString&&(r.sessionKey=e.sessionKey);var n=Object.assign({},t,r);return me(n)}(t,ye(n[1]))},Oe={accept:"application/json"},we=function(e){return Object.assign({},(t=e.ip)?{"X-FORWARDED-FOR":t}:{},function(e){var t=e.sessionKey,r=e.sessionKeyInQueryString;return!t||r?{}:{"X-SESSION":t}}(e));var t},Pe=function(e,t){return t.log("Requesting",e),function(e,t){var r=Object.assign({},Oe,we(t)),n=Se(e,t);return t.log("Sending a GET request to: "+n+" with the following headers",r),ie(n,{credentials:"same-origin",headers:r}).then(function(e){if(e.status>=400)throw t.log("GET failed with status",e.status),e;return e})}(e,t).then(function(e){return e.json()}).then(function(e){return t.log("GET response",e),e})},je=function(e,t,r,n){void 0===r&&(r={});var o=Object.assign({},Oe,{"Content-Type":"application/json"},we(t)),i=Se(e,t);t.log("Sending a POST request to: "+i+". With the following headers and body: ",o,r);var s={headers:o,credentials:"same-origin",method:"post",body:n?r:JSON.stringify(r)};return ie(i,s).then(function(e){var r=e.status,n=e.statusText;if(200!==r)throw new Error("Accedo One POST request returned a non-200 response. Status Code: "+r+". Status Text: "+n);var o={status:r,statusText:n};return t.log("POST response: ",o),o})},Ae=null,De=Pe,Ke=function(e){Ae=e},Le=function(){return Ae},xe=te({methods:{getSessionKey:function(){return this.config.sessionKey},setSessionPromise:function(e){this.config.useSharedSession?Ke(e):this.sessionPromise=e},getSessionPromise:function(){return this.config.useSharedSession?Le():this.sessionPromise},createSession:function(){var e=this,t=this.getSessionPromise();if(t)return t;var r=De("/session",this.config).then(function(t){var r=t.sessionKey;return e.config.sessionKey=r,r}).catch(function(t){throw e.setSessionPromise(null),t});return this.setSessionPromise(r),r},clearCurrentSession:function(){this.config.sessionKey=null,this.setSessionPromise(null)},refreshAndRefetch:function(e,t,r){var n=this;if(e&&401===e.status)return Promise.resolve(this.getSessionPromise()).then(function(e){return e&&e!==r?(n.config.sessionKey=e,e):(n.clearCurrentSession(),n.createSession())}).then(t);throw e},withSessionHandling:function(e){var t=this;return Promise.resolve(this.getSessionPromise()).then(function(r){return t.config.sessionKey=r,r?e().catch(function(n){return t.refreshAndRefetch(n,e,r)}):t.createSession().then(e)})}}}),Te=Pe,Ce=be;function Ie(e,t){var r=this,n=Ce(e,t);return this.withSessionHandling(function(){return Te(n,r.config)})}var Ee=xe.compose({methods:{getEntries:function(e){return Ie.call(this,"/content/entries",e)},getEntryById:function(e,t){return Ie.call(this,"/content/entry/"+e,t)},getEntryByAlias:function(e,t){return Ie.call(this,"/content/entry/alias/"+e,t)}}}),Re=Pe,He=xe.compose({methods:{getApplicationStatus:function(){var e=this;return this.withSessionHandling(function(){return Re("/status",e.config)})}}}),Ne=Pe,ke=xe.compose({methods:{getAllAssets:function(){var e=this;return this.withSessionHandling(function(){return Ne("/asset",e.config)})}}}),Be=je;function ze(e,t){var r=this,n={eventType:e};return void 0!==t&&(n.retentionTime=t),this.withSessionHandling(function(){return Be("/event/log",r.config,n)})}var Ue=xe.compose({methods:{sendUsageStartEvent:function(){return ze.call(this,"START")},sendUsageStopEvent:function(e){return ze.call(this,"QUIT",e)}}}),qe=Pe,Fe=xe.compose({methods:{getAllEnabledPlugins:function(){var e=this;return this.withSessionHandling(function(){return qe("/plugins",e.config)})}}}),Ge=Pe,Qe=xe.compose({methods:{getProfileInfo:function(){var e=this;return this.withSessionHandling(function(){return Ge("/profile",e.config)})}}}),_e=Pe,Ve=be;function Me(e,t){var r=this,n=Ve(e,t);return this.withSessionHandling(function(){return _e(n,r.config)})}var Je=xe.compose({methods:{getAllMetadata:function(e){return Me.call(this,"/metadata",e)},getMetadataByKey:function(e,t){return Me.call(this,"/metadata/"+e,t)},getMetadataByKeys:function(e,t){return Me.call(this,"/metadata/"+e.join(","),t)}}}),We=Pe,Xe=je;function $e(e){var t=this;return this.withSessionHandling(function(){return We(e,t.config)})}function Ye(e,t){var r=this;return this.withSessionHandling(function(){return Xe(e,r.config,t)})}function Ze(e,t){return $e.call(this,"/"+e+"/"+t)}function et(e,t,r){return $e.call(this,"/"+e+"/"+t+"/"+r+"?json=true")}function tt(e,t,r){return Ye.call(this,"/"+e+"/"+t,r)}function rt(e,t,r,n){return Ye.call(this,"/"+e+"/"+t+"/"+r,n)}var nt=xe.compose({methods:{getAllApplicationScopeDataByUser:function(e){return Ze.call(this,"user",e)},getAllApplicationGroupScopeDataByUser:function(e){return Ze.call(this,"group",e)},getApplicationScopeDataByUserAndKey:function(e,t){return et.call(this,"user",e,t)},getApplicationGroupScopeDataByUserAndKey:function(e,t){return et.call(this,"group",e,t)},setApplicationScopeUserData:function(e,t){return tt.call(this,"user",e,t)},setApplicationGroupScopeUserData:function(e,t){return tt.call(this,"group",e,t)},setApplicationScopeUserDataByKey:function(e,t,r){return rt.call(this,"user",e,t,r)},setApplicationGroupScopeUserDataByKey:function(e,t,r){return rt.call(this,"group",e,t,r)}}}),ot=Pe,it=xe.compose({methods:{getAvailableLocales:function(){var e=this;return this.withSessionHandling(function(){return ot("/locales",e.config)})}}}),st=Pe,at=je,ct=["debug","info","warn","error"],ut=function(e,t){void 0===e&&(e={});var r=function(e,t){return t?JSON.stringify([e,t]):e}(e.message,t);return{code:e.errorCode||0,message:r,dim1:e.dim1,dim2:e.dim2,dim3:e.dim3,dim4:e.dim4}};var lt=xe.compose({init:function(e,t){var r,n=t.instance,o={};n.getLogLevel=function(){if(r)return r;var e=o.logLevel,t=o.timestamp;return void 0===t&&(t=0),Date.now()-t<18e4?Promise.resolve(e):r=function(e){var t=this;return this.withSessionHandling(function(){return st(e,t.config)})}.call(n,"/application/log/level").then(function(e){var t=e.logLevel;return r=null,o={logLevel:t,timestamp:Date.now()},t}).catch(function(e){throw r=null,e})}},methods:{sendLogs:function(e){var t=e.map(function(e){var t=e.logType,r=e.timestamp;return Object.assign(ut(e,e.metadata),{logType:t,timestamp:r})});return function(e){var t=this;return this.withSessionHandling(function(){return at("/application/logs",t.config,e)})}.call(this,t)}}}),pt=lt;lt.getLogEvent=ut,lt.ALLOWED_LEVELS=ct;var ft=B(xe,Ee,He,ke,Ue,Fe,Qe,Je,nt,it,pt),dt=je,vt=pt.ALLOWED_LEVELS,gt=pt.getLogEvent,ht=vt.concat(["off"]);var yt=xe.compose(pt,{init:function(e,t){var r=t.instance,n={data:[],totalLength:0,timeoutID:void 0},o=function(){(function(e){var t=this,r=e.data,n=e.timeoutID;return clearTimeout(n),r.length?this.withSessionHandling(function(){return dt("/application/logs",t.config,"["+r.join(",")+"]",!0)}).catch(function(e){throw t.config.log("The batched logs could not be sent. "+r.length+" logs lost",e),e}):Promise.resolve()}).call(r,n),n={data:[],totalLength:0,timeoutID:void 0}},i=function(e){n.data.push(e),n.totalLength+=e.length,clearTimeout(n.timeoutID),n.timeoutID=setTimeout(o,12e4)};!function(e){try{window.addEventListener("beforeunload",e),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e()})}catch(e){console.error("Accedo One SDK event listeners could not be attached",e)}}(o),r.sendLog=function(e,t){for(var s=[],a=arguments.length-2;a-- >0;)s[a]=arguments[a+2];return vt.includes(e)?r.getLogLevel().then(function(r){if(ht.indexOf(r)>ht.indexOf(e))return Promise.resolve({status:200,statusText:"Request avoided",requestAvoided:!0});var a=s.length?1===s.length?s[0]:s:void 0,c=JSON.stringify(Object.assign(gt(t,a),{logType:e,timestamp:Date.now()})),u=c.length;if(u>2e6)return Promise.reject({status:400,statusText:"Request oversized"});var l=n.totalLength;if(l+u<2e5)i(c);else{var p=l+u>2e6;p||i(c),o(),p&&i(c)}return Promise.resolve({status:200,statusText:"Request queued for batch",requestQueued:!0})}):Promise.reject("Unsupported log level")}}});return O(ft.compose(yt))});
